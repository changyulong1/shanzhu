import{by as g,bE as S,bx as m,bV as x,bW as D,bF as e,bR as p,bM as k}from"./vendor.c05b4a82.js";import{u as w,M as E,B as I,I as N,F as j,a as r,b as A,v as M,h as q,c as f}from"./index.f0e4b71d.js";import"./vant.0f526e14.js";const L=c=>{const t=g(c);return{ref:t,toggle:()=>t.value=!t.value,on:()=>t.value=!0,off:()=>t.value=!1}},O="_logo_ly99d_1",R="_icon_ly99d_8",T="_appName_ly99d_12",n={logo:O,icon:R,appName:T},G=S({setup(c,t){const b=w(),o=m({email:"",code:""}),s=m({email:[],code:[]}),y=x(),B=D(),F=async a=>{var u;if(a.preventDefault(),Object.assign(s,{email:[],code:[]}),Object.assign(s,M(o,[{key:"email",type:"required",message:"\u5FC5\u586B"},{key:"email",type:"pattern",regex:/.+@.+/,message:"\u5FC5\u987B\u662F\u90AE\u7BB1\u5730\u5740"},{key:"code",type:"required",message:"\u5FC5\u586B"}])),!q(s)){const l=await f.post("/session",o,{_autoLoading:!0}).catch(i);localStorage.setItem("jwt",l.data.jwt);const V=(u=B.query.return_to)==null?void 0:u.toString();b.refreshMe(),y.push(V||"/")}},i=a=>{throw a.response.status===422&&Object.assign(s,a.response.data.errors),a},{ref:v,toggle:U,on:C,off:_}=L(!1),d=g(),h=async()=>{C(),await f.post("/validation_codes",{email:o.email},{_autoLoading:!0}).catch(i).finally(_),d.value.startCount()};return()=>e(k,null,[e(E,null,{title:()=>"\u767B\u5F55",icon:()=>e(I,null,null),default:()=>e("div",{class:n.wrapper},[e("div",{class:n.logo},[e(N,{class:n.icon,name:"mangosteen"},null),e("h1",{class:n.appName},[p("\u5C71\u7AF9\u8BB0\u8D26")])]),e(j,{onSubmit:F},{default:()=>{var a,u;return[e(r,{label:"\u90AE\u7BB1\u5730\u5740",type:"text",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1\uFF0C\u7136\u540E\u70B9\u51FB\u53D1\u9001\u9A8C\u8BC1\u7801",modelValue:o.email,"onUpdate:modelValue":l=>o.email=l,error:(a=s.email)==null?void 0:a[0]},null),e(r,{ref:d,label:"\u9A8C\u8BC1\u7801",type:"validationCode",placeholder:"\u8BF7\u8F93\u5165\u516D\u4F4D\u6570\u5B57",countFrom:5,disabled:v.value,onClick:h,modelValue:o.code,"onUpdate:modelValue":l=>o.code=l,error:(u=s.code)==null?void 0:u[0]},null),e(r,{style:{paddingTop:"96px"}},{default:()=>[e(A,{type:"submit"},{default:()=>[p("\u767B\u5F55")]})]})]}})])})])}});export{G as SignInPage,G as default};
